<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        .card {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #0f3460;
        }
        h1 { color: #4facfe; }
        h2 { color: #00f2fe; margin-top: 0; }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .success { background: #1a472a; border-left: 4px solid #00d26a; }
        .error { background: #4a1a1a; border-left: 4px solid #ff4757; }
        .warning { background: #4a3a1a; border-left: 4px solid #ffa502; }
        .info { background: #1a2a4a; border-left: 4px solid #4facfe; }
        button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            padding: 12px 24px;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { opacity: 0.9; }
        pre {
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .url-box {
            background: #0f3460;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å’Œé£å¤©æ°” API è¯Šæ–­å·¥å…·</h1>

    <div class="card">
        <h2>é…ç½®ä¿¡æ¯</h2>
        <p><strong>API Key:</strong> <code id="apiKey"></code></p>
        <p><strong>å½“å‰åŸŸåçŠ¶æ€:</strong> <span id="domainStatus">æ£€æµ‹ä¸­...</span></p>
    </div>

    <div class="card info">
        <h3>ğŸ“‹ å’Œé£å¤©æ°” API ç«¯ç‚¹è¯´æ˜</h3>
        <p><strong>å…è´¹ç‰ˆå¼€å‘ç‰ˆ API:</strong></p>
        <div class="url-box">https://devapi.qweather.com/v7/...</div>
        <p><strong>å•†ä¸šç‰ˆ API:</strong></p>
        <div class="url-box">https://api.qweather.com/v7/...</div>
        <p class="warning">âš ï¸ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…è´¹ç‰ˆï¼Œå¿…é¡»ä½¿ç”¨ devapi.qweather.com</p>
    </div>

    <div class="card">
        <h2>è¯Šæ–­æµ‹è¯•</h2>
        <button onclick="testAllAPIs()">ğŸš€ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
        <button onclick="testFreeVersion()">æµ‹è¯•å…è´¹ç‰ˆç«¯ç‚¹</button>
        <button onclick="testPaidVersion()">æµ‹è¯•å•†ä¸šç‰ˆç«¯ç‚¹</button>
    </div>

    <div id="results"></div>

    <script>
        const API_KEY = 'a3de64eb28f5452ca64bcfbcf51d9935';
        const CITY_CODE = '101010100'; // åŒ—äº¬

        function addResult(title, content, type = 'info', url = '') {
            const resultsDiv = document.getElementById('results');
            const card = document.createElement('div');
            card.className = 'card';
            let html = `
                <div class="status ${type}">
                    <h3>${title}</h3>
                </div>
            `;
            if (url) {
                html += `<div class="url-box">URL: ${url}</div>`;
            }
            html += `<pre>${JSON.stringify(content, null, 2)}</pre>`;
            card.innerHTML = html;
            resultsDiv.insertBefore(card, resultsDiv.firstChild);
        }

        async function testEndpoint(apiBase, endpointName) {
            const urls = {
                'å®æ—¶å¤©æ°”': `${apiBase}/weather/now?key=${API_KEY}&location=${CITY_CODE}`,
                '3å¤©é¢„æŠ¥': `${apiBase}/weather/3d?key=${API_KEY}&location=${CITY_CODE}`,
                '7å¤©é¢„æŠ¥': `${apiBase}/weather/7d?key=${API_KEY}&location=${CITY_CODE}`,
            };

            const results = {};

            for (const [name, url] of Object.entries(urls)) {
                try {
                    console.log(`æµ‹è¯• ${endpointName} - ${name}:`, url);
                    const response = await fetch(url);
                    const data = await response.json();

                    results[name] = {
                        status: response.status,
                        success: response.ok,
                        code: data.code,
                        message: getMessageByCode(data.code)
                    };

                    if (response.ok && data.code === '200') {
                        results[name].data = data;
                    }
                } catch (error) {
                    results[name] = {
                        error: error.message
                    };
                }
            }

            return results;
        }

        function getMessageByCode(code) {
            const messages = {
                '200': 'æˆåŠŸ',
                '204': 'è¯·æ±‚æˆåŠŸï¼Œä½†æ— æ•°æ®',
                '400': 'è¯·æ±‚é”™è¯¯',
                '401': 'è®¤è¯å¤±è´¥ï¼ŒAPI Key é”™è¯¯',
                '402': 'è¶…è¿‡é…é¢é™åˆ¶',
                '403': 'æ— æƒé™è®¿é—®',
                '404': 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨',
                '500': 'æœåŠ¡å™¨é”™è¯¯'
            };
            return messages[code] || 'æœªçŸ¥é”™è¯¯';
        }

        async function testFreeVersion() {
            const results = await testEndpoint('https://devapi.qweather.com/v7', 'å…è´¹ç‰ˆ');
            addResult('ğŸ†“ å…è´¹ç‰ˆ API æµ‹è¯•ç»“æœ', results, 'info');
        }

        async function testPaidVersion() {
            const results = await testEndpoint('https://api.qweather.com/v7', 'å•†ä¸šç‰ˆ');
            addResult('ğŸ’° å•†ä¸šç‰ˆ API æµ‹è¯•ç»“æœ', results, 'info');
        }

        async function testAllAPIs() {
            document.getElementById('results').innerHTML = '';

            addResult('ğŸ” å¼€å§‹è¯Šæ–­', {
                message: 'æ­£åœ¨æµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹...',
                api_key: API_KEY.substring(0, 8) + '...',
                note: 'è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯'
            }, 'info');

            // æµ‹è¯•å…è´¹ç‰ˆ
            const freeResults = await testEndpoint('https://devapi.qweather.com/v7', 'å…è´¹ç‰ˆ');

            // æµ‹è¯•å•†ä¸šç‰ˆ
            const paidResults = await testEndpoint('https://api.qweather.com/v7', 'å•†ä¸šç‰ˆ');

            // åˆ†æç»“æœ
            let recommendation = '';
            let successCount = 0;

            // æ£€æŸ¥å…è´¹ç‰ˆ
            const freeNow = freeResults['å®æ—¶å¤©æ°”'];
            const free3d = freeResults['3å¤©é¢„æŠ¥'];

            if (freeNow && freeNow.success && freeNow.code === '200') {
                successCount++;
                recommendation += '\nâœ… å…è´¹ç‰ˆå®æ—¶å¤©æ°” API å¯ç”¨';
            }

            if (free3d && free3d.success && free3d.code === '200') {
                successCount++;
                recommendation += '\nâœ… å…è´¹ç‰ˆ3å¤©é¢„æŠ¥ API å¯ç”¨';
            }

            // æ£€æŸ¥å•†ä¸šç‰ˆ
            const paidNow = paidResults['å®æ—¶å¤©æ°”'];
            const paid3d = paidResults['3å¤©é¢„æŠ¥'];

            if (paidNow && paidNow.success && paidNow.code === '200') {
                successCount++;
                recommendation += '\nâœ… å•†ä¸šç‰ˆå®æ—¶å¤©æ°” API å¯ç”¨';
            }

            if (paid3d && paid3d.success && paid3d.code === '200') {
                successCount++;
                recommendation += '\nâœ… å•†ä¸šç‰ˆ3å¤©é¢„æŠ¥ API å¯ç”¨';
            }

            // é”™è¯¯è¯Šæ–­
            if (freeNow && freeNow.code === '403') {
                recommendation += '\n\nâŒ å…è´¹ç‰ˆè¿”å› 403 - å¯èƒ½åŸå› ï¼š';
                recommendation += '\n   â€¢ API Key ç±»å‹é”™è¯¯ï¼ˆå•†ä¸šç‰ˆ Key ç”¨åˆ°äº†å…è´¹ç‰ˆç«¯ç‚¹ï¼‰';
                recommendation += '\n   â€¢ API Key æ— æ•ˆæˆ–è¿‡æœŸ';
                recommendation += '\n   â€¢ éœ€è¦åœ¨æ§åˆ¶å°æ·»åŠ åº”ç”¨åŸŸå';
            }

            if (freeNow && freeNow.code === '402') {
                recommendation += '\n\nâš ï¸ è¶…è¿‡å…è´¹é…é¢é™åˆ¶';
                recommendation += '\n   â€¢ å…è´¹ç‰ˆæ¯å¤© 1,000 æ¬¡è¯·æ±‚';
                recommendation += '\n   â€¢ è¯·ç­‰å¾…æ¬¡æ—¥é‡ç½®æˆ–å‡çº§å¥—é¤';
            }

            addResult('ğŸ“Š è¯Šæ–­ç»“æœ', {
                æ€»æµ‹è¯•é¡¹: 6,
                æˆåŠŸé¡¹: successCount,
                å»ºè®®: recommendation.trim(),
                å…è´¹ç‰ˆå®æ—¶å¤©æ°”: freeNow,
                å…è´¹ç‰ˆ3å¤©é¢„æŠ¥: free3d,
                å•†ä¸šç‰ˆå®æ—¶å¤©æ°”: paidNow,
                å•†ä¸šç‰ˆ3å¤©é¢„æŠ¥: paid3d
            }, successCount > 0 ? 'success' : 'error');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤º API Key
        window.onload = () => {
            document.getElementById('apiKey').textContent = API_KEY ? `${API_KEY.substring(0, 8)}...` : 'æœªé…ç½®';

            // æ£€æŸ¥å½“å‰é¡µé¢åè®®
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            document.getElementById('domainStatus').textContent = `${protocol}//${hostname}`;
        };
    </script>
</body>
</html>
